{
  "name": "ecommerce-policy",
  "duration": 10000,
  "saveRawData": "false",
  "checkpointDir": "checkpoint",
  "timePrecision": "minute",
  "checkpointGranularity": "minute",
  "checkpointInterval": 30000,
  "checkpointTimeAvailability": 60000,
  "inputs": [
    {
      "name": "in",
      "elementType": "RabbitMQInput",
      "configuration": {
        "queue": "logsQueue",
        "host": "localhost",
        "port": 5672,
        "storageLevel": "MEMORY_ONLY",
        "exchangeName": "logsExchange",
        "routingKeys" : ["webLogsRoute","purchasesRoute"]
      }
    }
  ],
  "dimensions": [
    {
      "dimensionType": "DateTimeDimension",
      "name": "purchaseDateOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "userOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "totalAmountOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "cityOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "postalCodeOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "stateOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "countryOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "customerTypeOL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "paymentTypeOL"
    },
    {
      "dimensionType": "DateTimeDimension",
      "name": "timestampVL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "ipHostVL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "userAgentVL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "userLogVL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "responseCodeVL"
    },
    {
      "dimensionType": "PassthroughDimension",
      "name": "operatingSystemVL"
    }
  ],
  "rollups": [
    {
      "dimensionAndPrecision": [
        {
          "dimensionName": "purchaseDateOL",
          "precision": "minute"
        }
      ],
      "operators": ["count-operator","sum-operator","max-operator","min-operator","avg-operator"]
    },
    {
      "dimensionAndPrecision": [
        {
          "dimensionName": "timestampVL",
          "precision": "minute"
        }
      ],
      "operators": ["count-operator","sum-operator","max-operator","min-operator","avg-operator"]
    },
    {
      "dimensionAndPrecision": [
        {
          "dimensionName": "ipHostVL",
          "precision": "identity"
        },
        {
          "dimensionName": "timestampVL",
          "precision": "minute"
        }
      ],
      "operators": ["count-operator","sum-operator","max-operator","min-operator","avg-operator"]
    },
    {
      "dimensionAndPrecision": [
        {
          "dimensionName": "cityOL",
          "precision": "identity"
        }
      ],
      "operators": ["count-operator","sum-operator","max-operator","min-operator","avg-operator"]
    },
    {
      "dimensionAndPrecision": [
        {
          "dimensionName": "stateOL",
          "precision": "identity"
        }
      ],
      "operators": ["count-operator","sum-operator","max-operator","min-operator","avg-operator"]
    }
  ],
  "outputs": [
    {
      "name": "out-elasticsearch",
      "elementType": "ElasticSearchOutput",
      "configuration": {
        "nodes" : "localhost",
        "defaultPort" : "9200",
        "autoCalculateId" : "true",
        "dateType" : "timestamp",
        "indexMapping" : "day"
      }
    }
  ],
  "operators": [
    {
      "name": "count-operator",
      "elementType": "CountOperator",
      "configuration": {}
    },
    {
      "name": "avg-operator",
      "elementType": "AvgOperator",
      "configuration": {
        "inputField" : "totalAmountOL"
      }
    },
    {
      "name": "sum-operator",
      "elementType": "SumOperator",
      "configuration": {
        "inputField" : "totalAmountOL"
      }
    },
    {
      "name": "max-operator",
      "elementType": "MaxOperator",
      "configuration": {
        "inputField" : "totalAmountOL"
      }
    },
    {
      "name": "min-operator",
      "elementType": "MinOperator",
      "configuration": {
        "inputField" : "totalAmountOL"
      }
    }
  ],
  "parsers": [
    {
      "name": "morphline-parser",
      "elementType": "MorphlinesParser",
      "configuration": {
        "morphline": {
          "id": "morphline1",
          "importCommands": [
            "org.kitesdk.**"
          ],
          "commands": [
            {
              "readJson": {}
            },
            {
              "extractJsonPaths": {
                "paths": {
                  "purchaseDateOL": "/purchaseDate",
                  "userOL": "/user",
                  "totalAmountOL": "/totalAmount",
                  "cityOL": "/city",
                  "postalCodeOL": "/postalCode",
                  "stateOL": "/state",
                  "countryOL": "/country",
                  "customerTypeOL": "/customerType",
                  "paymentTypeOL": "/paymentType",
                  "timestampVL": "/timestamp",
                  "ipHostVL": "/ipHost",
                  "userAgentVL": "/userAgent",
                  "userLogVL": "/userLog",
                  "responseCodeVL": "/responseCode",
                  "operatingSystemVL": "/operatingSystem"
                }
              }
            },
            {
              "removeFields": {
                "blacklist": [
                  "literal:_attachment_body"
                ]
              }
            }
          ]
        }
      }
    },
    {
      "name": "purchaseDateOL",
      "elementType": "DateTimeParser",
      "configuration": {
        "purchaseDateOL": "unixMillis"
      }
    },
    {
      "name": "timestampVL",
      "elementType": "DateTimeParser",
      "configuration": {
        "timestampVL": "unixMillis"
      }
    }
  ]
}
