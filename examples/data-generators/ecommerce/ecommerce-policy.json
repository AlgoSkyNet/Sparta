{
  "name": "ecommerce-policy",
  "sparkStreamingWindow": 6000,
  "rawData": {
    "enabled": "false",
    "partitionFormat": "day",
    "path": "myTestParquetPath"
  },
  "checkpointing": {
    "path": "checkpoint",
    "timeDimension": "minute",
    "granularity": "minute",
    "interval": 30000,
    "timeAvailability": 60000
  },
  "inputs": [
    {
      "name": "in",
      "type": "RabbitMQ",
      "configuration": {
        "queue": "logsQueue",
        "host": "localhost",
        "port": 5672,
        "storageLevel": "MEMORY_ONLY",
        "exchangeName": "logsExchange",
        "routingKeys": [
          "webLogsRoute",
          "purchasesRoute"
        ]
      }
    }
  ],
  "cubes": [
    {
      "name": "testCube",
      "dimensions": [
        {
          "name": "purchaseDateOL",
          "field": "purchaseDateOL",
          "precision": "minute",
          "type": "DateTime"
        }
      ],
      "operators": [
        {
          "measureName": "count-operator",
          "type": "Count",
          "configuration": {}
        },
        {
          "measureName": "avg-operator",
          "type": "Avg",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "measureName": "sum-operator",
          "type": "Sum",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "max-operator",
          "type": "Max",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "min-operator",
          "type": "Min",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        }
      ]
    },
    {
      "name": "testCube1",
      "dimensions": [
        {
          "name": "timestampVL",
          "field": "timestampVL",
          "type": "DateTime",
          "precision": "minute"
        }
      ],
      "operators": [
        {
          "measureName": "count-operator",
          "type": "Count",
          "configuration": {}
        },
        {
          "measureName": "avg-operator",
          "type": "Avg",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "measureName": "sum-operator",
          "type": "Sum",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "max-operator",
          "type": "Max",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "min-operator",
          "type": "Min",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        }
      ]
    },
    {
      "name": "testCube2",
      "dimensions": [
        {
          "name": "ipHostVL",
          "field": "ipHostVL"
        },
        {
          "name": "timestampVL",
          "field": "timestampVL",
          "type": "DateTime",
          "precision": "minute"
        }
      ],
      "operators": [
        {
          "measureName": "count-operator",
          "type": "Count",
          "configuration": {}
        },
        {
          "measureName": "avg-operator",
          "type": "Avg",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "measureName": "sum-operator",
          "type": "Sum",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "max-operator",
          "type": "Max",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "min-operator",
          "type": "Min",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        }
      ]
    },
    {
      "name": "testCube3",
      "dimensions": [
        {
          "name": "cityOL",
          "field": "cityOL"
        }
      ],
      "operators": [
        {
          "measureName": "count-operator",
          "type": "Count",
          "configuration": {}
        },
        {
          "measureName": "avg-operator",
          "type": "Avg",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "measureName": "sum-operator",
          "type": "Sum",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "max-operator",
          "type": "Max",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "min-operator",
          "type": "Min",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        }
      ]
    },
    {
      "name": "testCube4",
      "dimensions": [
        {
          "name": "stateOL",
          "field": "stateOL"
        }
      ],
      "operators": [
        {
          "measureName": "count-operator",
          "type": "Count",
          "configuration": {}
        },
        {
          "measureName": "avg-operator",
          "type": "Avg",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "measureName": "sum-operator",
          "type": "Sum",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "max-operator",
          "type": "Max",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        },
        {
          "name": "min-operator",
          "type": "Min",
          "configuration": {
            "inputField": "totalAmountOL"
          }
        }
      ]
    }
  ],
  "outputs": [
    {
      "name": "out-elasticsearch",
      "type": "ElasticSearch",
      "configuration": {
        "nodes": "localhost",
        "defaultPort": "9200",
        "autoCalculateId": "true",
        "dateType": "timestamp",
        "indexMapping": "day"
      }
    }
  ],
  "transformations": [
    {
      "name": "morphline-parser",
      "order": 1,
      "type": "Morphlines",
      "outputFields": [
        "purchaseDateOL",
        "userOL",
        "totalAmountOL",
        "cityOL",
        "postalCodeOL",
        "stateOL",
        "countryOL",
        "customerTypeOL",
        "paymentTypeOL",
        "timestampVL",
        "ipHostVL",
        "userAgentVL",
        "userLogVL",
        "responseCodeVL",
        "operatingSystemVL"
      ],
      "configuration": {
        "morphline": {
          "id": "morphline1",
          "importCommands": [
            "org.kitesdk.**"
          ],
          "commands": [
            {
              "readJson": {}
            },
            {
              "extractJsonPaths": {
                "paths": {
                  "purchaseDateOL": "/purchaseDate",
                  "userOL": "/user",
                  "totalAmountOL": "/totalAmount",
                  "cityOL": "/city",
                  "postalCodeOL": "/postalCode",
                  "stateOL": "/state",
                  "countryOL": "/country",
                  "customerTypeOL": "/customerType",
                  "paymentTypeOL": "/paymentType",
                  "timestampVL": "/timestamp",
                  "ipHostVL": "/ipHost",
                  "userAgentVL": "/userAgent",
                  "userLogVL": "/userLog",
                  "responseCodeVL": "/responseCode",
                  "operatingSystemVL": "/operatingSystem"
                }
              }
            },
            {
              "removeFields": {
                "blacklist": [
                  "literal:_attachment_body"
                ]
              }
            }
          ]
        }
      }
    },
    {
      "name": "purchaseDateOL",
      "order": 2,
      "inputField": "purchaseDateOL",
      "outputFields": [
        "purchaseDateOL"
      ],
      "type": "DateTime",
      "configuration": {
        "purchaseDateOL": "unixMillis"
      }
    },
    {
      "name": "timestampVL",
      "order": 3,
      "inputField": "timestampVL",
      "outputFields": [
        "timestampVL"
      ],
      "type": "DateTime",
      "configuration": {
        "timestampVL": "unixMillis"
      }
    }
  ]
}